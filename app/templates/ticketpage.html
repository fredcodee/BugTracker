<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ticket page</title>
</head>
<body>
  <div>
    <a href="/home">home</a>
    {% with messages = get_flashed_messages() %}
    {% if messages%}
    <div class="alert alert-danger" role="alert">
      {{ messages[0] }}
    </div>
    {% endif%}
    {% endwith %}
    <div>
      <a href="/tickets/edit/{{ticket.id}}">Edit Ticket</a>
    </div>
    <h1>{{ticket.title}}</h1>
    <p>description: {{ticket.description}}</p>
    <p>submitter: {{ticket.user_ticket.name}}</p>
    <p>project name: {{ticket.project_ticket.project_name}}</p>
    <p>assigned to: {{ticket.assigned_dev}}</p>
    <p>status: {{ticket.status}}</p>
    <p>priority: {{ticket.priority}}</p>
    <p>ticket type: {{ticket.ticket_type}}</p>
    <p>ref number: {{ticket.ref_num}}</p>
    <p>created on: {{ticket.date}}</p>
    <hr>
    <h3>Comments</h3>
    <div>
      <form action="/tickets/view/{{ticket.id}}" method="POST" enctype="multipart/form-data">
        {{form.csrf_token}}
        <div>
          <label for="commnet">Comment</label>
          {{form.comment}}
        </div>
        <div>
          <label>Upload Image</label>
          {{form.image(class="form-control")}}
        </div>
        <input type="submit">
      </form>
    </div>
    <div>
      {% for comment in comments%}
        {% if comment.user_comment.name == current_user.name %}
        <div> 
          <small style="color: gray;">{{comment.user_comment.name}} - {{comment.user_comment.role}} - {{comment.date}}</small>
          <p>{{comment.details}}</p>
          <img src="{{url_for('static', filename='ticketfiles/%s' % comment['image'])}}" alt="" style="width: 25%; height: 30%;">
          <a href="/tickets/comment/delete/{{ticket.id}}/{{comment.id}}"><button>delete</button></a>
        </div>
        {% else %}
        <div>
          <small style="color: gray;">{{comment.user_comment.name}} - {{comment.user_comment.role}} - {{comment.date}}</small>
          <p>{{comment.details}}</p>
          <img src="{{url_for('static', filename='ticketfiles/%s' % comment['image'])}}" alt="" style="width: 25%; height: 30%;">
        </div>
        {%endif%}
      {% endfor %}
    </div>
    <hr>
    <div>
      <h3>Ticket history</h3>
      <div>
        {% for h in history%}
          <small>{{h.details}}</small>
          <small> on {{h.date}}</small>
        {% endfor %}
      </div>
    </div>

    <p></p>
  </div>
</body>
</html>